<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Oliver Young</title>
  <style>
    .copyright {
      text-align: center;
      font-size: 12px;
      color: #C8C8C8;
    }
  </style>
<style type="text/css">
#app {
  max-width: 1080px;
  margin: 0 auto;
}
#nav {
}
#social-media {
  margin: 6px;
  float: right;
}
#logo {
  
  height: 42px;
}
#header {
  margin: 80px auto;
  text-align: center;
  font-family: -apple-system, 'Helvetica Neue';
}
#header h1 {
  font-size: 38px;
  color: #333333;
}
#header p {
  font-size: 22px;
  color: #A9A9A9;
  -webkit-font-smoothing: antialiased;
}
.divider {
  height: 1px;
  background-color: #E6E6E6;
}
#post-list {
  max-width: 700px;
  margin: 80px auto;
  padding: 0;
}
#post-list li {
  list-style: none;
}
</style><style type="text/css">
.post-list {
  font-family: -apple-system, "Hiragino Sans GB", sans-serif;
}
.post-list h1 {
  font-size: 20px;
}
.post-list a {
  color: #333;
  text-decoration: none;
}
.post-list a:hover {
  text-decoration: underline;
}
.post-list .date, .post-list .category-and-tags {
  font-size: 12px;
  color: #9E9E9E;
}
.post-list .summary {
  font-size: 14px;
  line-height: 24px;
  color: #333;   
  overflow-wrap: break-word;
}
.post-list-divider {
    margin: 30px auto;
}
</style><style type="text/css">
.content {
  font-family: -apple-system, "Hiragino Sans GB", sans-serif;
  line-height: 1.75em;
  max-width: 700px;
  margin: 60px auto;
}
.entry-meta {
  font-size: 14px;
  color: #9E9E9E;
}
.content img {
  max-width: 100%;
}
pre {
  padding: 10px;
  overflow: auto;
  border: #E3EDF3 1px solid;
  background: #F7FAFB;
}
</style><style type="text/css">
#social-media a {
  font-family: -apple-system;
  color: #8B572A;
}
#social-media a:hover {
  color: #733F10;
}
</style><style type="text/css">
textarea {
  width: 100%;
  height: 400px;
}
.h1 {
  font-size: 24px;
}
</style><style type="text/css">
#app {
  max-width: 1080px;
  margin: 0 auto;
}
#nav {
}
#social-media {
  margin: 6px;
  float: right;
}
#logo {
  
  height: 42px;
}
#header {
  margin: 80px auto;
  text-align: center;
  font-family: -apple-system, 'Helvetica Neue';
}
#header h1 {
  font-size: 38px;
  color: #333333;
}
#header p {
  font-size: 22px;
  color: #A9A9A9;
  -webkit-font-smoothing: antialiased;
}
.divider {
  height: 1px;
  background-color: #E6E6E6;
}
#post-list {
  max-width: 700px;
  margin: 80px auto;
  padding: 0;
}
#post-list li {
  list-style: none;
}
.write-button-container {
  max-width: 700px;
  margin: 0 auto;
  margin-top: 60px;
  text-align: right;
}
.button {
  padding: 8px 16px;
  border: 1px solid rgba(0, 0, 0, .25);
  border-radius: 4px;
  text-decoration: none;
  color: rgba(0, 0, 0, .25);
  font-family: sans-serif;
  font-size: 14px;
}
.button:hover {
  border: 1px solid rgba(0, 0, 0, .45);
  color: rgba(0, 0, 0, .45);
}
</style><style type="text/css">
input, textarea {
  border: none;
}
textarea {
  height: 50px;
}
.post-list {
  font-family: -apple-system, "Hiragino Sans GB", sans-serif;
}
.title {
  font-size: 20px;
  font-weight: bold;
}
.post-list a:hover {
  text-decoration: underline;
}
.post-list .date, .post-list .category-and-tags {
  font-size: 12px;
  color: #9E9E9E;
}
.post-list .summary {
  font-size: 14px;
  line-height: 24px;
  color: #333;   
  overflow-wrap: break-word;
}
.post-list-divider {
    margin: 30px auto;
}
.operation {
  cursor: pointer;
}
</style></head>
<body>
    <div id="app"><div id="nav"><a href="/" class="router-link-active"><img id="logo" src="/logo.svg"></a> <p id="social-media"><a href="https://twitter.com/olimovier">Twitter</a> / <a href="https://www.instagram.com/olimovier/">Instagram</a> / <a href="/feed.xml">RSS</a></p></div> <div class="content view"><h1>关于Drupal7模板的那些事儿</h1> <footer class="entry-meta">发布于 2017年11月2日。属于 技术 分类，被贴了 Drupal 标签。</footer> <div><p>这篇文章最初发布于2013年4月20日。由于一些原因，图片和代码部分存在缺失，请谅解！待博客平台稳定后会逐步添加进去。</p>
<hr>
<p>最早接触drupal是在2012年的8月份。那时候，我刚从创恩IT教育毕业，没过多久我就以php软件工程师的身份进入博科资讯股份有限公司，面对的就是基于drupal7的主题开发。不知不觉接触drupal已经快一年了，我实在非常热爱drupal，所以想把自己对drupal开发的一些心得拿出来与大家分享。</p>
<p>###一、一个小例子
首先，我将通过一个小例子向大家引入Drupal7中模板的概念。假设你已经搭建了本地环境，并且可以自由地在本地机器上测试drupal。如果有朋友不会搭建环境，请去网上搜一下教程，花费一点儿时间应该就能够完成了。</p>
<p>####1.实际需求
drupal7.22安装完成后，我们能够看到drupal7.22的庐山真面目 了，大致的样式见下图：</p>
<p>这时候如果我想把drupal的图标drupal_logo和站点名称（即上图中的localhost）位置对掉一下该怎么办呢?</p>
<p>####2.需求分析
也许你觉得drupal既然如此强大，它肯定能通过后台进行设置，从而控制相关内容的排列方式，于是你会花上好一番力气进行寻找。但是根据我的经验，这一需求想要通过drupal的后台配置是无法实现的。通过配置最多只能控制是否显示图标或站点名称，对于他们的排列顺序则无能为例。那么到底是什么控制了他们的顺序了呢？其实有点经验的前端开发人员肯定知道，答案是html结构。那drupal的html结构又是怎么一回事呢？我在哪儿可以找到这个页面对应的html文件？难道我要对每一张页面的html文件都进行修改吗？如果你能够提出这些问题，那么我会感到非常开心。</p>
<p>####3.解决方案
打开/themes/bartik/templates/page.tpl.php文件。首先忽略掉那些开头是*的行，都是注释，不起什么实际作用。直接跳到92行左右，往下看到122行左右，可以看到差不多类似这样的一些代码:</p>
<p>将黄色部分代码与红色部分代码位置对换，然后保存文件。回到刚才的页面刷新一下吧！看到变化了吗？</p>
<p>我们的需求实现了，为自己鼓一下掌吧！</p>
<p>###二、Drupal7模板介绍</p>
<p>####1.什么是模板？
在第一部分的例子中，我们修改的文件就是Drupal7中的模板文件。通俗一点来说，凡是以.tpl.php结尾的都是Drupal7中的模板文件。</p>
<p>####2.模板有什么作用？
在讨论模板的作用之前，我不得不提一下另外一个概念——主题（theme）。</p>
<p>在drupal7中，模板一般是基于主题这个概念下的。什么是主题呢？打开根目录下的themes目录，看到的一个个文件夹就是Drupal7默认的主题，主题又分为前台主题和后台主题。一般我们说的主题都是指前台主题。抽象一点来说，主题就是一个Drupal网站的风格，而模板就是实现网站风格的一种手段。模板的具体功能是修改一个页面的结构或者修改一类页面的结构。</p>
<p>####3.都有哪些模板？
Drupal7本身有许多默认的模板文件，而这些模板文件都在各自的领域起作用，下面介绍几个常用的模板文件：
html.tpl.php</p>
<p>打开modules/system/，你就能找到html.tpl.php文件，文件本身带了大量的注释，通过阅读注释，你对这个模板文件的了解就差不多了。这是一个关于html结构的模板文件，当我们需要在特定页面中修改头部()内容时，譬如：加一个meta标签，引入一个js文件，引入一个css文件，就需要覆写这个模板文件。</p>
<p>page.tpl.php</p>
<p>同样在modules/system/目录下可以找到page.tpl.php模板文件，同样地阅读注释吧！对这个模板文件有一个大致的了解。修该页面布局时，经常会使用到这个文件，这个模板文件就像是一个大的框架，把一个页面的各个部分组合起来，站点信息、导航、内容、区域等他们之间的结构关系都可以通过覆写这个模板文件来实现。请记住，它只是一个大框架，更具体的内容结构它是无能为力的。想要修改更具体的内容结构需要覆写特定的模板文件。</p>
<p>node.tpl.php</p>
<p>在modules/node/下可以找到node.tpl.php模板文件，打开文件阅读注释吧！还记得我在介绍page.tpl.php中说过，page.tpl.php是无法修改具体内容的结构的，如果要修改具体内容的结构需要特定的模板文件。而这个node.tpl.php就是其中之一，先说一下node的概念吧！一篇文章、一个页面就是一个node，node中有标题、摘要、正文等信息，当我们需要修改这些信息之间的结构关系时，可以覆写这个模板文件。</p>
<p>####4.什么是覆写（override）？
当你有一个实际需求，并且知道需要修改模板文件来实现这个需求时，你会感到迷茫，不知道该修改哪个模板文件！其实使用“修改”这个动词是不太恰当的，当你需要修改的模板文件存在时才称得上修改。如果不存在，通常我们的做法是通过主题的钩子(hook)机制覆写(override)默认模板文件。这里又有一个新概念——钩子(hook)，钩子是Drupal的核心思想，也是其精华所在。由于我对Drupal7核心的掌握程度有限，不敢在这里对这个概念妄加评论。我们暂时把钩子(hook)理解为一种规则吧！通俗一点来说，Drupal对模板的调用是有一套规则的，而这套规则是建立在模板文件的名称之上的，也就是说Drupal通过模板文件的名称来调用特定模板，我们也可以通过给模板文件一个特定的命令让Drupal来调用。</p>
<p>Drupal7中的模板设计得非常精细以及巧妙，接下去对几个常用模板的hook机制进行介绍：</p>
<p>page--[front|internal/path].tpl.php</p>
<p>这里的internal path必须是内部路径，并非url别名，这里大家必须注意一下。page模板主要根据页面的路径来调用相应的模板。比如，如果我想覆写主页page层次的模板，只要page.tpl.php这个基础模板拷贝到你的主题中，并重命名为page--front.tpl.php，修改其中的内容，并清空缓存就可以了</p>
<p>所以，对于page.tpl.php模板的覆写，我们必须注意页面的内部路径。比如我们想要覆写page.tpl.php模板的一个页面的内部路径是node/1/edit, 那么Drupal7会在你的主题中按照以下顺序检查模板文件，如果存在就调用:</p>
<p>1.page--front.tpl.php（当且仅当该页面被设置为首页时）</p>
<p>2.page--node--edit.tpl.php</p>
<p>3.page--node--1.tpl.php</p>
<p>4.page--node--%.tpl.php</p>
<p>5.page--node.tpl.php</p>
<p>6.page.tpl.php</p>
<p>如果一个都找不到，Drupal7就会调用默认的模板文件page.tpl.php</p>
<p>html层次的模板文件调用规则其实和page层次的调用规则是类似的，在这里就不作赘述了，读者可以自己进行测试。</p>
<p>node--[type|nodeid].tpl.php</p>
<p>node层次的模板文件的调用规则相对就比较简单了，主要是依据内容类型来调用模板。举例来说，我创建了一个内容类型叫做产品，机读名称是product，那么如果我想让所有属于产品这一内容类型的内容都调用同一个模板，我只要基础模板node.tpl.php拷贝到我的主题目录下并重命名为node--product.tpl.php，再修改里面的内容，最后清空缓存就可以了。只是针对一个内容类型来创建模板，也可以根据node的id来创建模板，例如node--231.tpl.php就只针对nodeid是231的内容起作用。</p>
<p>以上主要介绍了三种常用的模板文件及其在drupal内部的调用规则，其实这里的调用规则也是可以自己定制的，不过这已经不在本文的讨论范围之内了，有兴趣的朋友可以自己去研究。了解了这三个模板之后，对于其他的模板文件，也就是举一反三了，首先了解这个模板在drupal中的层次，然后了解drupal对它的调用规则，大多数的的调用规则都可以在官方文档中找到。</p>
<p>###三、Drupal7模板高级应用</p>
<p>文档刚开始的时候举的例子只是为了引入drupal模板的概念，这里我将举一个稍微复杂一点的例子，从实际应用出发，加深大家对模板的理解。</p>
<p>####1.实际需求
未登陆状态下，默认主题的登陆界面实在太突兀了，到哪儿都有它，简直有点让人受不了，必须改变他才行。</p>
<p>已登陆状态下，明明管理菜单上已经有了查看账户和注销按钮，可是页面上也有这两个按钮，不是多此一举吗！</p>
<p>所以理想中的未登陆和已登陆的页面应该是这样的。</p>
<p>登录按钮只在首页显示</p>
<p>####2.需求分析
实际需求明确了，效果图都出来了，我们就该思考一下怎么实现效果图了。去掉登录界面是一件很容易的事，有点drupal后台操作经验的人应该都会，在结构——区块中把已经放置到相关区域的登录区块去掉就行了。可是这个登录区块去除后，该怎么登录呢？不用担心，有一个地址，类似于localhost/?q=user，这个路径对应的就是登陆页面，当然localhost/?q=user/register这个地址对应的是注册页面。已登录状态下，这两个路径则分别对应我的账户和编辑我的账户页面。至于为什么这两个路径对应的是登录和注册页面，就不是我们要关心的问题了，大家有兴趣的话可以自己去研究。既然两个登录和注册页面的路径知道了，接下去只要把这两个超链接添加到各自的按钮或者文字上就行了。但是通过一种什么方式把这两个带着超链接的文字添加到页面上去呢？并且，最重要的一点是这两个按钮只在未登录状态下显示，在已登录状态下隐藏。还有一个需求就是页面上不要显示我的账户及注销按钮，只在管理栏上显示。对于这两个需求，实现方式可能有许多，可是我认为最合理的方式就是通过模板来实现。</p>
<p>####3.解决方案
既然确定通过模板来实现需求，接下来就要明确这些需求关哪些模板的事了，从而对这些模板进行覆写或修改。从页面的结构来看，我们需要修改的部分在整张页面的头部。之前我们讨论过的模板层次问题在这儿就要派上用场了，头部显然不归node模板关，也不关html模板什么事，那就只剩下page模板了，错了，大错特错，虽然答案是对的，但是论证过程是极其错误的。虽然我只谈论了三种模板，但是drupal中的模板是非常多的，也有可能是block模板或者region模板控制了我们要修改的内容。之所以能确定是page模板在起作用，依靠的应该是对每一种模板的熟悉，而非逻辑判断。知道了该覆写或修改哪个模板之后，接下去的工作就简单了，在该模板的适当位置加入一些内容，删除一些内容。对于只在首页现实自制的登录文字链接，就要用到主题的hook机制了，还记得关于page模板的hook机制吗？如何表示首页的，没错就是page—front.tpl.php。也就是说，在page—ront.tpl.php模板中加入判断是否登录，未登录的话显示登录按钮；而在page.tpl.php中删除页面上的My account和Log out按钮。具体的实现方法在这儿就不多说了，相信大家都有能力去实现。</p>
<p>关于Drupal7的模板我想说的就这么多。大家有任何的意见或建议，都可以给我留言。</p>
</div> <input type="hidden" id="loaded-signal"></div> <p class="copyright">Copyright © 2017 MOVIER.ME - All Rights Reserved.</p></div>
  


</body></html>